{%extends "base.html"%}
{%set subtitle = "Overview \u2014 Application Review"%}
{%block extrahead%}
{{load_script('js/localize-time.js')}}
{%endblock%}
{%block nav%}
{{nav_breadcrumb(url_for("application"), "Application")}}
{{nav_breadcrumb(url_for("application_review_list"), "Review", True)}}
{%endblock%}
{%block content%}
      <h1>Application Review: Overview</h1>
      <nav>
        <span class="form-label">Filter:</span>
        {%set cur_filter = request.args.get('filter')%}
        <a class="btn btn-outline-secondary{%if not cur_filter%} active{%endif%} ms-2" href="{{add_query(filter=None)}}">All</a>
        <a class="btn btn-outline-primary{%if cur_filter == 'PENDING'%} active{%endif%} ms-1" href="{{add_query(filter='PENDING')}}">Pending</a>
        <a class="btn btn-outline-secondary{%if cur_filter == 'RESOLVED'%} active{%endif%} ms-1" href="{{add_query(filter='RESOLVED')}}">Resolved</a>
        <a class="btn btn-outline-success{%if cur_filter == 'ACCEPTED'%} active{%endif%} ms-1" href="{{add_query(filter='ACCEPTED')}}">Accepted</a>
        <div class="btn-group ms-1">
          <a class="btn btn-outline-warning{%if cur_filter == 'REJECTED'%} active{%endif%}" href="{{add_query(filter='REJECTED')}}">Rejected</a>
          <button class="btn btn-outline-warning dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"></button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item{%if cur_filter == 'REJECTED_HIDDEN'%} active{%endif%}" href="{{add_query(filter='REJECTED_HIDDEN')}}">Hidden</a></li>
            <li><a class="dropdown-item{%if cur_filter == 'REJECTED_PUBLIC'%} active{%endif%}" href="{{add_query(filter='REJECTED_PUBLIC')}}">Public</a></li>
          </ul>
        </div>
      </nav>
      {%if entries%}
      <table class="table table-hover align-baseline">
        <thead>
          <tr>
            <th>User</th>
            <th>Status</th>
            <th>Submitted</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {%for entry in entries%}
          <tr>
            <td>{{entry.name}}</td>
            <td>
              <span class="badge-group">
                {%for keyword in entry.status.split('_')%}
                {%set badge_cls = {'PENDING': 'bg-primary',
                                   'ACCEPTED': 'bg-success',
                                   'REJECTED': 'bg-warning text-dark',
                                   'PUBLIC': 'bg-info text-dark'}.get(keyword, 'bg-secondary')%}
                <span class="badge rounded-pill {{badge_cls}}">{{keyword}}</span>
                {%endfor%}
              </span>
            </td>
            <td>{{render_timestamp(entry.timestamp)}}</td>
            <td class="py-0">
              {%if entry.status == 'PENDING'%}
              <a href="{{url_for('application_review', uid=entry.uid)}}" class="btn btn-outline-primary btn-sm btn-tight">Review</a>
              {%endif%}
            </td>
          </tr>
          {%endfor%}
        </tbody>
      </table>
      {%else%}
      <p class="mt-2"><i>No applications</i></p>
      {%endif%}
      <nav class="d-flex flex-wrap gap-2">
        <ul class="pagination justify-content-center mx-auto mb-0">
          <li class="page-item{%if offset == 0%} disabled{%endif%}"><a class="page-link" href="{{add_query(offset=None)}}">&#171;</a></li>
          <li class="page-item{%if offset == 0%} disabled{%endif%}"><a class="page-link" href="{{add_query(offset=max(offset - amount, 0))}}">&#8249;</a></li>
          <li class="page-item active"><a class="page-link" href="">{{(offset // amount) + 1}}</a></li>
          <li class="page-item{%if not has_more%} disabled{%endif%}"><a class="page-link" href="{{add_query(offset=offset + amount)}}">&#8250;</a></li>
        </ul>
        <a class="btn btn-outline-secondary" href="{{url_for('index')}}">Back to main page</a>
      </nav>
{%endblock%}
